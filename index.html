<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        .dashboard {
            position: fixed;
            right: 0;
            bottom: 0;
            padding: 16px 12px;
        }
    </style>
    <script src="Vector.js"></script>
</head>
<body>
    <canvas id="canvas" style="display: block"></canvas>
    <div class="dashboard">
        <button>构造凸包</button>
    </div>

    <script>
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        window.onresize = () =>
        {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        const ConvexList = []
        const Mode = {
            None : 1,
            CreateConvex : 2,
        }

        let currentConvex = -1;
        let mode = Mode.None;
        let ctx = canvas.getContext("2d");
        canvas.onclick = evt =>
        {
            switch (mode) {
                case Mode.CreateConvex :
                    ConvexList[currentConvex].AddPoint(new Vector2(evt.offsetX, evt.offsetY));
                    break;
            }
        }

        window.addEventListener("keyup", evt => {
            switch (evt.key){
                case "c" :
                    mode = Mode.CreateConvex;
                    ConvexList.push(new Convex([]))
                    currentConvex ++;
                    break;
                case "Escape" :
                    mode = Mode.None;
            }
        })

        Tick();
        function Tick() {
            ctx.fillStyle = "#000000"
            ctx.fillRect(0, 0, canvas.width, canvas.height)
            ConvexList.forEach(c => {
                c.verteis.forEach(point => {
                    ctx.beginPath()
                    ctx.arc(point.x, point.y, point.size, 0, 2 * Math.PI)
                    ctx.fillStyle = point.color
                    ctx.fill()

                    ctx.beginPath()
                    ctx.strokeStyle = "#ffffff"
                    ctx.strokeText(point.id, point.x + point.size / 2, point.y - point.size / 2, 16)
                    ctx.stroke()
                })
            })
            requestAnimationFrame(Tick)
        }

    </script>
</body>
</html>